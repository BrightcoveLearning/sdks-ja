---
title: ネイティブSDKを含むピクチャーインピクチャー
description: このトピックでは、Brightcove Native Player SDKを使用して、アプリにPicture inPictureモードを実装する方法を学習します。
parent: Features 
grandparent: Home
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概要</h2>

<p>ピクチャインピクチャ（PIP）モードでは、ユーザーはデバイスでマルチタスクを実行できます。この機能を使用すると、ユーザーが他のタスクを実行しながら、小さなビデオ再生ウィンドウを画面の隅に固定するアプリを作成できます。</p>

<figure class="bcls-figure"><img class="bcls-image--no-border" width="600" alt="Picture in picture mode" src="/assets/images/getting-started/pip/android-steps.png" />
<figcaption class="bcls-caption--image">ピクチャモードでの画像</figcaption>
</figure>
</section>

<section class="bcls-section">
<h2 id="Features">特徴</h2>

<p>Brightcoveのネイティブ SDK が提供するピクチャインピクチャ機能は、次の機能をサポートしています。</p>

<ul>
	<li>ユーザーがコントロールバーの PIP アイコンをクリックしてピクチャモードで画像を入力する場合、開発者はプログラムで PIP モードに入ることができます。</li>
	<li>ユーザーは、PIP ウィンドウを画面の隅にドラッグして、最も便利な場所に配置できます。</li>
	<li>ユーザーは、PIP ウィンドウでビデオを一時停止して再生するか、完全に削除することができます。また、ユーザーは動画を最大化してアプリ内体験に戻すことができます。</li>
	<li>PIP モードは、アプリ、デバイスの背景、その他のアプリケーション上で動作します。</li>
</ul>
</section>

<section class="bcls-section">
<h2 id="Supported_versions">サポートされているバージョン</h2>

<p>ピクチャモードの画像は、次のバージョンでサポートされています。</p>

<h3>デバイスOSのバージョン</h3>

<ul>
	<li><strong>Android:</strong>オレオ8.0以上（APIレベル26以上）</li>
	<li><strong>iOS: </strong>10.0+</li>
</ul>

<h3>ネイティブSDKバージョン</h3>

<ul>
	<li><strong>Android:</strong>Android 版Brightcoveネイティブ SDK バージョン 6.1.0+</li>
	<li><strong>iOS: </strong>iOS 版Brightcoveのネイティブ SDK バージョン 6.4.4 以降</li>
</ul>
</section>

<section class="bcls-section">
<h2 id="Android_implementation">Androidの実装</h2>

<p>次のトピックは、ピクチャインピクチャ機能の開始に役立ちます。</p>

<ul>
	<li><a href="#Using_BrightcovePlayer">ブライトCovePlayerを使用する</a></li>
	<li><a href="#Using_a_regular_Activity">通常のアクティビティを使用する</a></li>
	<li><a href="#Customizing_picture_in_picture">画像内の図をカスタマイズする</a></li>
</ul>

<p>詳細については、Android <a href="https://developer.android.com/guide/topics/ui/picture-in-picture.html">のピクチャインピクチャーサポートガイドを参照してください</a>。</p>

<h3 id="Using_BrightcovePlayer">ブライトCovePlayerを使用する</h3>

<p>ピクチャインピクチャの使用を開始する最も簡単な方法は、あなたの活動を拡張することです<code translate="No">BrightcovePlayer</code> .これを行うには、次の手順を実行します。</p>

<ol class="bcls-tasklist">
	<li><strong>styles.xml </strong>ファイルで、次のコードを追加して、ピクチャインピクチャボタンを有効にします。

	<pre class="line-numbers">
<code class="language-xml" translate="No">&lt;style name="BrightcoveControlBar" parent="BrightcoveControlBarDefault"&gt;
    &lt;item name="brightcove_picture_in_picture"&gt;true&lt;/item&gt;
&lt;/style&gt;</code></pre>
	</li>
	<li><strong>AndroidManifest.xml </strong>ファイルで、以下を追加することにより、アクティビティの<a href="https://developer.android.com/guide/topics/ui/picture-in-picture.html#declaring"> Picture in Picture サポートを宣言します</a>。
	<pre class="line-numbers">
<code class="language-xml" translate="No">&lt;activity android:name="VideoActivity"
  android:resizeableActivity="true"
<span class="bcls-highlight">  android:supportsPictureInPicture="true"
  android:configChanges=
      "screenSize|smallestScreenSize|screenLayout|orientation"</span>
  ...
</code></pre>

	<p>これは重要なステップです。宣言しなかった場合、ユーザが Brightcove Media Controller の Picture in Picture ボタンを押すと、<code translate="No">IllegalStateException</code>がスローされます。</p>

	<pre>
<code class="language-java" translate="No">java.lang.IllegalStateException: enterPictureInPictureMode: Current activity does not support picture in picture</code></pre>
	</li>
</ol>

<p>ピクチャモードでピクチャを開始すると、アクティビティ自体のサイズが変更され、ピクチャウィンドウ内のピクチャ内のすべてのアクティビティコンポーネントが保持されます。これを回避し、実装を容易にするために、Brightcoveの動画ビューは、親レイアウトの幅と高さに合わせて、ピクチャウィンドウ内のピクチャウィンドウ内の動画のみを表示するように、自動的にフルスクリーン表示されます。このモードを終了すると、Brightcoveの動画ビューは元の状態に戻ります。</p>

<p>アプリにピクチャインピクチャが必要ない場合は、<strong> styles.xml </strong>ファイルに次のコードを追加して、[ピクチャインピクチャ] ボタンを無効にすることができます。</p>

<pre class="line-numbers">
<code class="language-xml" translate="No">&lt;style name="BrightcoveControlBar" parent="BrightcoveControlBarDefault"&gt;
    &lt;item name="brightcove_picture_in_picture"&gt;false&lt;/item&gt;
&lt;/style&gt;</code></pre>

<h3 id="Using_a_regular_Activity">通常のアクティビティを使用する</h3>

<p>前のセクションで説明したように<code translate="No">BrightcovePlayer</code>、ピクチャインピクチャのサポートを宣言することに加えて、拡張しないアクティビティを使用している場合は、いくつかの追加手順を実行する必要があります。</p>

<ol class="bcls-tasklist__restart">
	<li><strong>MainActivity.java </strong>ファイルを開きます。</li>
	<li><code translate="No">onCreate</code>アクティビティの方法で、アクティビティをBrightcoveに登録します<code translate="No">PictureInPictureManager</code>。
	<pre>
<code class="language-java" translate="No">PictureInPictureManager.getInstance().registerActivity(Activity, BrightcoveVideoView)</code></pre>
	</li>
	<li><code translate="No">onDestroy</code>メソッドで、アクティビティを登録解除します。
	<pre>
<code class="language-java" translate="No">PictureInPictureManager.getInstance().unregisterActivity(Activity)</code></pre>
	</li>
	<li>以下に示すように、<code translate="No">onPictureInPictureModeChanged</code>アクティビティメソッドをオーバーライドし、<code translate="No">onPictureInPictureModeChanged()</code>メソッドを呼び出します。
	<pre class="line-numbers">
<code class="language-java" translate="No">@Override
  public void onPictureInPictureModeChanged (boolean isInPictureInPictureMode, Configuration newConfig) {
     super.onPictureInPictureModeChanged(isInPictureInPictureMode, newConfig);
     PictureInPictureManager.getInstance().onPictureInPictureModeChanged(isInPictureInPictureMode, newConfig);
  }</code></pre>
	</li>
	<li>最後に、<code translate="No">onUserLeaveHint()</code> Activityメソッドをオーバーライドし、<code translate="No">onUserLeaveHint()</code>以下に示すように呼び出します。
	<pre class="line-numbers">
<code class="language-java" translate="No">@Override
  public void onUserLeaveHint () {
     super.onUserLeaveHint();
     PictureInPictureManager.getInstance().onUserLeaveHint();
  }</code></pre>
	</li>
</ol>

<p>以下の手順を実行すると、[ピクチャインピクチャ] ボタンが Brightcove メディアコントローラに自動的に表示されます。次のように、プログラムでピクチャをトリガーすることもできます。</p>

<pre>
<code class="language-java" translate="No">PictureInPictureManager.getInstance().enterPictureInPictureMode()</code></pre>

<aside class="bcls-aside bcls-aside--information">このメソッドを呼び出すと、<code translate="No">PictureInPictureManagerException</code>アクティビティが登録されていない場合。</aside>

<h3 id="Customizing_picture_in_picture">画像内の図をカスタマイズする</h3>

<p>[ピクチャ] ウィンドウのピクチャの動作と外観は、を使用してカスタマイズできます<code translate="No">PictureInPictureManager</code>。例えば、ウィンドウの縦横比を変更したり、動画のキャプションを有効/無効にすることができます。</p>

<p>Androidのオレオはネイティブにカスタマイズできる3つのパラメータを提供します。</p>

<ul>
	<li><a href="https://developer.android.com/reference/android/app/PictureInPictureParams.Builder.html#setAspectRatio(android.util.Rational)">アスペクト比</a>

	<pre>
<code class="language-java" translate="No">setAspectRatio(Rational)</code></pre>
	</li>
	<li><a href="https://developer.android.com/reference/android/app/PictureInPictureParams.Builder.html#setSourceRectHint(android.graphics.Rect)">ソース境界のヒント</a>
	<pre>
<code class="language-java" translate="No">setSourceRectHint(Rect)</code></pre>
	</li>
	<li><a href="https://developer.android.com/reference/android/app/PictureInPictureParams.Builder.html#setActions(java.util.List%3Candroid.app.RemoteAction%3E)">リモートアクションの一覧</a>
	<pre>
<code class="language-java" translate="No">setUserActions(List&lt;RemoteAction&gt;)</code></pre>
	</li>
</ul>

<h4>ユーザーアクション</h4>

<p>Brightcove では、<code translate="No">RemoteAction</code>デフォルトでが追加され、<code translate="No">Play/Pause</code>ビデオイベントを処理し、それぞれのアイコンが設定されます。つまり、<code translate="No">RemoteAction</code>次のように設定したリモートアクションのリストにデフォルトが追加されます。</p>

<pre>
<code class="language-java" translate="No">setUserActions</code></pre>

<p>設定できるアクションの数は限られていることに留意してください。<a href="https://developer.android.com/reference/android/app/Activity.html#getMaxNumPictureInPictureActions()">アクションの最大数を取得するには</a>、以下を呼び出します。</p>

<pre>
<code class="language-java" translate="No">Activity.getMaxNumPictureInPictureActions()</code></pre>

<h4>クローズドキャプション</h4>

<p>ピクチャモードでビデオを再生するときに、クローズドキャプションを有効または無効にするには、で以下を呼び出します<code translate="No">inPictureInPictureManager</code>。</p>

<pre>
<code class="language-java" translate="No">setClosedCaptionsEnabled(boolean)</code></pre>

<p>クローズドキャプションは、スマートフォンではデフォルトで無効になっていますが、タブレットでは有効になっています。ピクチャモードで再生しているときにクローズドキャプションのサイズを小さくするには、<code translate="No">0</code>以下を呼び出してからまでの値を設定します<code translate="No">1.0f</code>。</p>

<pre>
<code class="language-java" translate="No">setClosedCaptionsReductionScaleFactor(float)</code></pre>

<p>デフォルトでは、<code translate="No">0.5f</code>ピクチャモードのクローズドキャプションのサイズは元のサイズの 50% です。最後に、<code translate="No">onUserLeaveHint()</code>アクティビティが呼び出されたときにピクチャモードで画像を入力するには、次のように設定します<code translate="No">true</code>。</p>

<pre>
<code class="language-java" translate="No">setOnUserLeaveEnable(boolean)</code></pre>

<h4>パラメーター</h4>

<p>ピクチャパラメータ内の現在のピクチャを取得するには、次のメソッドを呼び出します。</p>

<pre>
<code class="language-java" translate="No">PictureInPicture.getBrightcovePictureInPictureParams()</code></pre>

<p>この呼び出しは、<code translate="No">BrightcovePictureInPictureParams</code>前に説明したすべてのパラメータのゲッターを持つオブジェクトを返します。</p>
</section>

<section class="bcls-section">
<h2 id="iOS_implementation">iOSの実装</h2>

<p><code translate="No">showPictureInPictureButton</code>ピクチャインピクチャの使用を開始するには、にを追加します<code translate="No">BCOVPUIPlayerViewOptions</code>。true に設定すると、サポートされているデバイスのプレーヤーコントロールにピクチャインピクチャボタンが追加されます。</p>
<p>ピクチャーインピクチャは、<a href="https://www.apple.com/ios/ios-14/features/"> iOS 14の新機能の1つです</a>。</p>

<p>詳細については、以下を参照してください。</p>

<ul>
	<li>iOS 用 Brightcove ネイティブ SDK の「<a href="https://github.com/brightcove/brightcove-player-sdk-ios#PIP">ピクチャインピクチャ</a>」セクションのリファレンス</li>
	<li><a href="https://developer.apple.com/documentation/avkit/adopting_picture_in_picture_in_a_custom_player">アップルがカスタムプレーヤードキュメントにピクチャインピクチャを採用している</a></li>
</ul>

<p>コード例については、<a href="https://github.com/BrightcoveOS/ios-player-samples/tree/master/Player/VideoCloudBasicPlayer">基本的なビデオ再生アプリを参照してください</a>。</p>
</section>

<section class="bcls-section">
<h2 id="Limitations">制約事項</h2>

<h3>Android</h3>

<ul>
	<li>ピクチャインピクチャはAndroid Oreo以上のデバイスでのみ動作します</li>
	<li>Android TVでは現在サポートされていません</li>
	<li>広告付きの動画はサポートされていません</li>
	<li>360ビデオはサポートされていません</li>
</ul>

<h3>iOS</h3>

<ul>
	<li>広告付きの動画はサポートされていません</li>
	<li>360ビデオはサポートされていません</li>
</ul>
</section>

<section class="bcls-section">
<h2 id="Known_issues">既知の問題</h2>

<h3>Android</h3>

<ul>
	<li>画像モードで画像を再生する Widevine で保護されたビデオは、Android 8.0 のピクセルCで透明または黒に変わることがわかりました。この問題は、Android 8.1と同じデバイスでは再現できません。</li>
</ul>
</section>
</article>