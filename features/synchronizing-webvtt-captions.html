---
title: 'WebVTTキャプションの同期' 
description: このトピックでは、HLSビデオのWebVTTキャプションを構成して、オーディオとビデオを字幕と同期させる方法を学習します。
parent: Features 
grandparent: Home
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概要</h2>

<p>Web ビデオテキストトラック (WebVTT) ファイルは、キャプション、字幕、説明などを動画内の時間セグメントに関連付けるために使用される単純なテキストファイルです。</p>

<pre class="line-numbers">
<code class="language-html" translate="No">WEBVTT

  00:00:03.50 --&gt; 00:00:05.000 align:middle line:84%
  In this video, you'll learn
  about how Video Cloud Studio is</code></pre>

<p>WebVTT ファイルの追加について詳しくは、<a href="https://player.support.brightcove.com/general/adding-captions-videos-programmatically.html">ビデオへのキャプションの追加ドキュメントを参照してください</a>。</p>

<!-- <p>The <a href="https://github.com/brightcove/brightcove-player-sdk-ios-sidecarsubtitles">Sidecar Subtitles plugin</a> enables you to use WebVTT captions in your iOS and tvOS apps.</p> -->
</section>

<section class="bcls-section">
<h2 id="Add_a_metadata_header">メタデータヘッダーを追加する</h2>

<p>HLS 仕様の一部として、オーディオとビデオのタイムスタンプを字幕と同期させるために、各 WebVTT <code translate="No">X-TIMESTAMP-MAP</code>ヘッダーにメタデータヘッダーを追加する必要があります。</p>

<p>このヘッダーがない場合、<code translate="No">MPEGTS</code>または値が正しくない場合は、字幕が動画と同期していない可能性があります。これは、<code translate="No">X-TIMESTAMP-MAP</code>ヘッダーが見つからない場合、<strong>クライアントはデフォルトのタイムスタンプオフセットを 0 </strong>と仮定するためです。たとえば、<strong> 900000 </strong>と<strong> 0 </strong>の値を使用した場合の違いにより、キャプションが 10 秒オフになる可能性があります。</p>

<p><code translate="No">X-TIMESTAMP-MAP</code>フォーマット:</p>

<pre class="line-numbers">
<code class="language-swift" translate="No">X-TIMESTAMP-MAP=MPEGTS:&lt;MPEG-2 time&gt;,LOCAL:&lt;cue time&gt;</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="2" data-gist-hide-footer="true"></code></p> -->

<p>WebVTT ファイルのサンプルを次に示します。</p>

<aside class="bcls-aside bcls-aside--information">NS <code translate="No">X-TIMESTAMP-MAP</code>ヘッダーは2行目の直後に表示する必要があります<code translate="No">WEBVTT</code>ライン。タイムスタンプヘッダーが2行目に配置されていない場合、予期しない結果が発生する可能性があります。</aside>

<pre class="line-numbers">
<code class="language-swift" translate="No">WEBVTT
<span class="bcls-highlight">X-TIMESTAMP-MAP=MPEGTS:900000,LOCAL:00:00:00.000</span>

1
00:00:03.500 --&gt; 00:00:05.000 align:middle line:84%
In this video, you'll learn
about how Video Cloud Studio is</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="5-11" data-gist-highlight-line="6" data-gist-hide-footer="true"></code></p> -->

<p>詳細については、Apple の HLS プロトコルドキュメントの「<a href="https://tools.ietf.org/html/draft-pantos-http-live-streaming-18#section-3">字幕セグメント</a>」セクションを参照してください。</p>
</section>

<section class="bcls-section">
<h2 id="Determine_the_offset_value">オフセット値を決定する</h2>

<p>Brightcoveのダイナミックインジェストまたは Zencoder を使用してコンテンツをトランスコードする場合は、オフセット値を使用します<code translate="No">MPEGTS:900000</code>。</p>

<p>Zencoder 以外のエンコーディングシステムを使用している場合は、必要な値を取得することをお勧めします。Apple では、エンコードされたビデオに合わせてオフセットを設定することをお勧めします。</p>

<p><code translate="No">MPEGTS</code>この値は、<code translate="No">LOCAL</code>指定された時間における MPEG フレームのプレゼンテーションタイムスタンプ (PTS) の値に対応します。Brightcoveのレガシーインジェストシステムを使用している場合は、の値を使用できます<code translate="No">MPEGTS:0</code>。</p>

<p>アカウントが有効になっている場合<a href="https://studio.support.brightcove.com/general/overview-dynamic-delivery.html">動的配信</a>、そしてあなたは私たちと一緒にキャプションをホストしています <em>（非リモートキャプション）</em>、次にすべてを自動的に魔法のように機能させます（PTSはゼロである必要があり、確実にゼロにする必要があります）。</p>

<p>アカウントで動的配信が有効になっていて、を使用している場合<strong><em>リモート</em></strong>キャプションの場合、PTS値をゼロに設定する必要があります。</p>

<p>たとえば、オフセット値を取得するには、次のようにします。</p>

<h3>リクエスト 1:</h3>

<p>ターミナルで、HLS ビデオを取得し、ローカルファイルに保存します。この場合、<code translate="No">seg.ts</code>私たちはそれを命名しています。</p>

<pre class="line-numbers">
<code class="language-http" translate="No">curl -o seg.ts "http://brightcove.vo.llnwd.net/v1/unsecured/media/4360108595001/201507/1154/4360341622001/4360108595001_4360341622001_s-1.ts?pubId=4360108595001&amp;videoId=4360283683001"</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="17-18"></code></p> -->

<h3>リクエスト 2:</h3>

<p>次に、<code translate="No">ffprobe</code>コマンドを使用して、オフセット値を取得します。<code translate="No">ffprobe</code>は、<a href="//ffmpeg.org/about.html"> FFmpeg フレームワークの一部であるマルチメディアストリームアナライザです</a>。これをコンピュータにダウンロードしてインストールする必要があります。</p>

<pre class="line-numbers">
<code class="language-http" translate="No">ffprobe -show_frames seg.ts</code></pre>

<h3>応答:</h3>

<p>回答は次のようになります。</p>

<pre class="line-numbers">
<code class="language-html" translate="No"><span class="bcls-highlight">pkt_pts=900000</span>
pkt_pts_time=10.000000
pkt_dts=900000
pkt_dts_time=10.000000</code></pre>
<!-- <p><code data-gist-id="d59006640cce4709fdc2" data-gist-line="21-24" data-gist-highlight-line="21" data-gist-hide-footer="true"></code></p> -->

<br/>
<aside class="bcls-aside bcls-aside--warning">X-TIMESTAMP-MAPヘッダーを追加すると、Windowsモバイルアプリケーションなどの他のプラットフォームで不整合が発生する可能性があります。オフセットヘッダーを追加したら、必ずすべてのプラットフォームでテストしてください。このヘッダータグの追加はHLS仕様の要件であり、WebVTT仕様のパラメーターではありません。</aside>
</section>

<section class="bcls-section">
<h2 id="Best_practices">ベストプラクティス</h2>

<p>以下のガイドラインは、キャプション付きのアプリを開発する際に役立ちます。</p>

<h3>キャプション期間</h3>

<p>キャプションのデュレーションは、動画の再生時間を超えないようにすることをお勧めします。これにより、ビデオの再生が完了した後、キャプションを表示したり、プログレスバーに表示できない領域が表示されなくなります。</p>
</section>
</article>