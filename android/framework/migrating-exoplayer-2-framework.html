---
title: 'ExoPlayer2フレームワークへの移行' 
description: このトピックでは、Android用のBrightcove Native PlayerSDKでExoPlayer2フレームワークを使用する方法を学習します。
parent: Framework 
grandparent: Androidの開発
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概要</h2>
<aside class="bcls-aside bcls-aside--information">
<p>ExoPlayer 1 を使用する Android 用 Brightcove ネイティブ SDK は廃止されました。</p>

<p>必要に応じて、<a href="/android/reference/exoplayer1/javadoc/index.html"> ExoPlayer 1 のリファレンスドキュメントを参照できますが</a>、ExoPlayer 2 フレームワークに移行することをお勧めします。</p>
</aside>

<p><a href="https://google.github.io/ExoPlayer/">GoogleのExoPlayerは</a>、Android用のオープンソース、アプリケーションレベルのメディアプレーヤーです。Brightcoveは ExoPlayer を活用して、提供するメリットを活用しています。ExoPlayer にアップグレードする利点の詳細については、<a href="https://www.brightcove.com/en/blog/2018/01/brightcove-native-sdk-exoplayer-2">Brightcoveのネイティブ SDK と exoPlayer 2 </a>のブログ記事を参照してください。</p>

<p>次のプロジェクトタイプで移行する方法を学びます。</p>

<ul>
	<li><a href="#New_project">新しいプロジェクト</a></li>
	<li><a href="#Existing_ExoPlayer_1_project">既存の exoPlayer 1 プロジェクト</a></li>
	<li><a href="#Existing_MediaPlayer_project">既存の MediaPlayer プロジェクト</a></li>
</ul>

<p>を参照してください<a href="https://github.com/BrightcoveOS/android-player-samples">ExoPlayerサンプルアプリケーション</a>統合に関する追加のガイダンスについては<a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2</a>プロジェクトへのフレームワーク。</p>
</section>

<section class="bcls-section">
<h2 id="New_project">新しいプロジェクト</h2>

<p>以下の手順に従って、新しい Android プロジェクトに exoPlayer 2 を追加します。</p>

<ol class="bcls-tasklist">
	<li><strong>build.gradleファイルで</strong>、次の依存関係を追加します。

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li><code translate="No">transitive</code>オプションを設定すると、<code translate="No">true</code>オフライン再生プラグインなどの他の依存関係を自動的に含めるようにgradleに指示します。5未満のgradleバージョンを使用している場合、<a href="https://docs.gradle.org/current/userguide/dependency_management.html">推移的な依存関係はデフォルトでオフになっています</a>。したがって、次のステートメントを追加する必要があります。
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>SDK バージョンに環境変数を使用している場合は、<strong> gradle.properties </strong>ファイルを開き、Android 用 Native SDK の現在のバージョン値を設定します。これは次のようになります。
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_ExoPlayer_1_project">既存の exoPlayer 1 プロジェクト</h2>

<p>ExoPlayer 2 フレームワークを使用するように既存の ExoPlayer 1 プロジェクトを更新するには、次の手順に従います。</p>

<ol class="bcls-tasklist-restart">
	<li><strong>constants.gradleファイルで</strong>、Androidビルドツールのバージョンを更新します：

	<pre class="line-numbers">
<code class="language-java" translate="No">buildToolsVersion "28.0.2"
</code></pre>
	</li>
	<li><strong>build.gradleファイルで</strong>、Androidサポートライブラリを更新します。
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.android.support:appcompat-v7:${APPCOMPAT_V7_VERSION}'
implementation 'com.android.support:support-v4:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:recyclerview-v7:${SUPPORT_V4_VERSION}'
implementation 'com.android.support:support-vector-drawable:${SUPPORT_V4_VERSION}'
</code></pre>

	<p>定数の現在の値は、<a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/constants.gradle"> constants.gradleファイルに見つけることができます</a>。</p>
	</li>
	<li><strong>build.gradleファイルで</strong>、GoogleのMavenリポジトリを追加します。
	<pre class="line-numbers">
<code class="language-java" translate="No">maven {
  url 'https://maven.google.com'
}
</code></pre>
	</li>
	<li>プロジェクトで Google IMA で広告を使用している場合は、Google Play サービス広告を更新してください。
	<pre class="line-numbers">
<code class="language-java" translate="No">implementation 'com.google.android.gms:play-services-ads:'+PLAY_SERVICES_VERSION
</code></pre>

	<aside class="bcls-aside bcls-aside--information">ここで重要なのは、Android用のBrightcove Native Player SDKは、ExoPlayerとExoPlayer2の両方を使用しようとするアプリケーションをサポートしていないということです。</aside>
	</li>
	<li><strong>build.gradle </strong>ファイルで、以前に次のような依存関係として Brightcove ExoPlayer ライブラリをインポートしました。
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer:${anpVersion}"
}
</code></pre>

	<p>依存関係の名前を変更します。</p>

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}
</code></pre>

	<p>Brightcove SDK バージョン ( <code translate="No">anpVersion</code> ) の現在の値は、<a href="https://github.com/BrightcoveOS/android-player-samples/blob/master/gradle.properties"> gradle.properties </a>ファイルにあります。</p>
	</li>
	<li><code translate="No">transitive</code>オプションを設定すると、<code translate="No">true</code>オフライン再生プラグインなどの他の依存関係を自動的に含めるようにgradleに指示します。5未満のgradleバージョンを使用している場合、<a href="https://docs.gradle.org/current/userguide/dependency_management.html">推移的な依存関係はデフォルトでオフになっています</a>。したがって、次のものを追加する必要があります。
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
	implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>SDK バージョンに環境変数を使用している場合は、<strong> gradle.properties </strong>ファイルを開き、Android 用 Native SDK の現在のバージョン値を設定します。これは次のようになります。
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>

	<p>ExoPlayer 2 をプロジェクトに統合するために、追加のコーディングは必要ありません。</p>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Existing_MediaPlayer_project">既存の MediaPlayer プロジェクト</h2>

<p>ExoPlayer 2 フレームワークを使用するように既存の MediaPlayer プロジェクトを更新するには、次の手順に従います。</p>

<ol class="bcls-tasklist-restart">
	<li><strong>build.gradleファイルで</strong>、次の依存関係を追加します。

	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}"
}</code></pre>
	</li>
	<li><code translate="No">transitive</code>オプションを設定すると、<code translate="No">true</code>オフライン再生プラグインなどの他の依存関係を自動的に含めるようにgradleに指示します。5未満のgradleバージョンを使用している場合、<a href="https://docs.gradle.org/current/userguide/managing_transitive_dependencies.html">推移的な依存関係はデフォルトでオフになっています</a>。したがって、次のものを追加する必要があります。
	<pre class="line-numbers">
<code class="language-java" translate="No">dependencies {
  implementation "com.brightcove.player:exoplayer2:${anpVersion}" <span class="bcls-highlight">{transitive = true}</span>
}</code></pre>
	</li>
	<li>SDK バージョンに環境変数を使用している場合は、<strong> gradle.properties </strong>ファイルを開き、Android 用 Native SDK の現在のバージョン値を設定します。これは次のようになります。
	<pre class="line-numbers">
<code class="language-java" translate="No">anpVersion=6.5.0</code></pre>
	</li>
	<li>アプリで、<a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveExoPlayerVideoView.html"> BrightcoveExoPlayerVideoView</a>の代わりに<a href="/android/reference/javadoc/com/brightcove/player/view/BrightcoveVideoView.html">BrightcoveVideoView</a>、Android MediaPlayerを使用します。</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Breaking_changes">変更を破る</h2>

<p>Android 版 Brightcove ネイティブ SDK に対する以下の変更により、ExoPlayer 2 の変更が壊れています。Brightcoveのネイティブ SDK では、ExoPlayer 1 の使用が廃止されました。</p>

<h3>exoPlayerVideoDisplayComponent 内部リスナー</h3>

<p><code translate="No">ExoPlayerVideoDisplayComponent</code>クラスを使用すると、ExoPlayer コンポーネントのステータスを取得するようにリスナーを設定できます。以下は、リスナーのいくつかのリストです：</p>

<table class="bcls-table">
	<thead class="bcls-table__head">
		<tr>
			<th>リスナーを設定する</th>
			<th>に関するステータス情報を受け取る</th>
		</tr>
	</thead>
	<tbody class="bcls-table__body">
		<tr>
			<td>setデバッグリスナー</td>
			<td>infolistener</td>
		</tr>
		<tr>
			<td>setCaptionリスナー</td>
			<td>キャプションリスナー</td>
		</tr>
		<tr>
			<td>setMetadatalistener</td>
			<td>Metadatalistener</td>
		</tr>
		<tr>
			<td>SetInternalErrorListener</td>
			<td>InternalErrorListener</td>
		</tr>
	</tbody>
</table>

<p>以下は、ExoPlayer 2 の使用に関する推奨事項です。</p>

<h4>infolistener</h4>

<p><code translate="No">InfoListener</code>インターフェイスでは、次の変更が加えられました。</p>

<ul>
	<li><code translate="No">onAvailableRangeChanged</code>メソッドが削除されました</li>
	<li><code translate="No">onLoadStarted</code>メソッドには、<code translate="No">length</code>追加のパラメータがあります</li>
</ul>

<p>例：exoPlayerVideoDisplayerComponent exoPlayer 2を使っている</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InfoListener {
void onVideoFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onAudioFormatEnabled(Format format, int trigger, long mediaTimeMs);
void onDroppedFrames(int count, long elapsed);
void onBandwidthSample(int elapsedMs, long bytes, long bitrateEstimate);
void onLoadStarted(int sourceId, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs);
void onLoadCompleted(int sourceId, long bytesLoaded, int type, int trigger, Format format,
				long mediaStartTimeMs, long mediaEndTimeMs, long elapsedRealtimeMs, long loadDurationMs);
void onDecoderInitialized(String decoderName, long initializedTimestampMs,
				long initializationDurationMs);
}</code></pre>

<h4>キャプションリスナー</h4>

<p><code translate="No">CaptionListener</code>インターフェイスは変更されません。</p>

<p>例：exoPlayerVideoDisplayer v2 を使っているコンポーネント</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface CaptionListener {
void onCues(List&lt;Cue&gt; cues);
}</code></pre>

<h4>Metadatalistener</h4>

<p><code translate="No">MetadataListener</code>インターフェイスは exoPlayer v2 で導入されました。<code translate="No">Id3MetadataListener</code>以前の使用は廃止されました。</p>

<p>例：exoPlayerVideoDisplayer v2 を使っているコンポーネント</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface MetadataListener {
void onMetadata(Metadata metadata);
}</code></pre>

<p>新しいと<code translate="No">MetadataListener</code>あなたは受け取るでしょう<code translate="No">Metadadata</code>のオブジェクト<code translate="No">onMetadata</code>折り返し電話。非推奨では<code translate="No">Id3MetadataListener</code>、Id3Frame オブジェクトのリストを受け取りました。以下に示すように、新しいリスナーを使用すると、<code translate="No">Id3Frame</code>まだオブジェクトのリストを取得することができます。</p>

<pre class="line-numbers">
<code class="language-java" translate="No">exoPlayerVideoDisplayComponent.setMetadataListener(new ExoPlayerVideoDisplayComponent.MetadataListener() {
@Override
public void onMetadata(Metadata metadata) {
 for(int i = 0; i &lt; metadata.length(); i++) {
		 Metadata.Entry entry = metadata.get(i);
		 if (entry instanceof Id3Frame) {
				 Id3Frame id3Frame = (Id3Frame) entry;
		 }
 }
}
});
</code></pre>

<h4>InternalErrorListener</h4>

<p><code translate="No">InternalErrorListener</code>インターフェイスには多くの変更点があります。比較については、以下のコードをご確認ください。</p>

<p>exoPlayerVideoDisplayer v2 を使っているコンポーネント</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onPlayerError(Exception e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>exoPlayerVideoDisplayer v1 を使用するコンポーネント ( <strong>非推奨</strong> )</p>

<pre class="line-numbers">
<code class="language-java" translate="No">public interface InternalErrorListener {
void onRendererInitializationError(Exception e);
void onAudioTrackInitializationError(AudioTrack.InitializationException e);
void onAudioTrackWriteError(AudioTrack.WriteException e);
void onAudioTrackUnderrun(int bufferSize, long bufferSizeMs, long elapsedSinceLastFeedMs);
void onDecoderInitializationError(MediaCodecTrackRenderer.DecoderInitializationException e);
void onCryptoError(MediaCodec.CryptoException e);
void onLoadError(int sourceId, IOException e);
void onDrmSessionManagerError(Exception e);
}
</code></pre>

<p>ExoPlayer 2 を使用する場合、<code translate="No">onPlayerError(Exception e)</code>発生する例外の種類はですが<code translate="No">com.google.android.exoplayer2.ExoPlaybackException</code>、これは将来変更される可能性があります。</p>

<p>com.google.android.exoPlayer2.expackException を使用すると、次の例外タイプを取得できます。</p>

<ul>
	<li><code translate="No">ExoPlaybackException.TYPE_SOURCE</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_RENDERER</code></li>
	<li><code translate="No">ExoPlaybackException.TYPE_UNEXPECTED</code></li>
</ul>

<p><code translate="No">Throwable</code>でオブジェクトを取得することで、エラーの原因を取得することもできます<code translate="No">ExoPlaybackException.getSourceException()</code>。</p>

<h3>オフライン再生のサポート</h3>

<p>プロジェクトで、<code translate="No">MediaDownloadable.setConfigurationBundle(Bundle)</code>ビデオビットレートなどのダウンロード設定を指定する方法を使用している場合は、次のようにコードを更新してください。</p>

<p>古い形式 (非推奨)</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.google.android.exoplayer.MediaFormat
</code></pre>

<p>新しいフォーマット</p>

<pre class="line-numbers">
<code class="language-java" translate="No">com.brightcove.player.model.MediaFormat
</code></pre>

<h3>レガシーメディア API クラス</h3>

<p>で廃止されたレガシー Media API クラスは、Android 用 Brightcove ネイティブ SDK から削除されました。<code translate="No">com.brightcove.player.media package</code></p>

<p>Media クラスを使用していた場合は、クラスを移行して使用を開始する必要があります。<code translate="No">com.brightcove.player.edge.Catalog</code></p>

<p><code translate="No">com.brightcove.player.media</code>次のクラスがからに移動されました<code translate="No">com.brightcove.player.model</code> :</p>

<ul>
	<li><code translate="No">DeliveryType.java</code></li>
	<li><code translate="No">CaptionType.java</code></li>
	<li><code translate="No">ErrorFields.java</code></li>
	<li><code translate="No">VideoFields.java</code></li>
</ul>

<aside class="bcls-aside bcls-aside--tip">これらの4つのクラスのいずれかを使用している場合は、インポートパッケージを置き換えるだけで、すべての設定が完了します。</aside>
</section>

<section class="bcls-section">
<h2 id="Additional_Resources">その他のリソース</h2>

<p>ExoPlayer 2 フレームワークの使用の詳細については、次のドキュメントを参照してください。</p>

<ul>
	<li><a href="https://medium.com/google-exoplayer/exoplayer-2-x-new-package-and-class-names-ef8e1d9ba96f">ExoPlayer 2-新しいパッケージ名とクラス名</a></li>
	<li><a href="https://google.github.io/ExoPlayer/guide.html">ExoPlayer 開発者ガイド</a></li>
</ul>
</section>
</article>