---
title: 'Android用ネイティブSDKによるAndroidPieのサポート' 
description: このトピックでは、AndroidPieをBrightcoveNative SDK forAndroidで使用する方法について学習します。
parent: Framework 
grandparent: Androidの開発
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

<section class="bcls-section">
<h2 id="Overview">概要</h2>

<p>Android Pieは最新のAndroid OSであり、2018年8月6日に正式にリリースされました。機能の詳細については、<a href="https://developer.android.com/about/versions/pie/android-9.0"> Android Pie 機能のドキュメントを参照してください</a>。Androidパイには、いくつかの動作の変更が含まれています。それらのほとんどは Android Pie (API レベル 28) をターゲットとするアプリに影響しますが、Android Pie デバイスで実行されている古いバージョンの Android をターゲットとするアプリでも問題が発生する可能性があります。</p>

<figure class="bcls-figure"><img class="bcls-image--no-border" alt="Android 9 Pie" src="/assets/images/android/framework/android-pie.png" />
<figcaption class="bcls-caption--image">Android9パイ</figcaption>
</figure>

<p>Android 版 Brightcove SDK を使用するときに注意すべき変更がいくつかあります。</p>

<ul>
	<li><a href="">TLS はデフォルトで有効になっています</a></li>
	<li><a href="">Apache HTTP クライアントの非推奨</a></li>
	<li><a href="">廃止された定数</a></li>
</ul>

<p>アプリの動作変更の全リストについては、「<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all">すべてのアプリの動作の変更</a>」ドキュメントを参照してください。Android Pie <a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28">をターゲットとする場合の排他的な動作の変更については、API 28 以降の動作の変更を参照してください</a>。</p>
</section>

<section class="bcls-section">
<h2 id="TLS_enabled_by_default">TLS はデフォルトで有効になっています</h2>

<p>トランスポート層セキュリティ (TLS) は、コンピュータネットワーク上で安全な通信を提供するためのプロトコルです。TLS は HTTP の上に実装され、HTTPS を介した暗号化通信が可能です。</p>

<p>Google が Android マシュマロ（API レベル 23）をリリースしたとき、クリアテキストトラフィックを無効にする設定が提供され、アプリがクリアな HTTP リクエストを行うのを防ぐことができます。Android Pie（API レベル 28）のリリースでは、クリアテキストトラフィックはデフォルトで無効になっています。</p>

<p>クリアテキストトラフィックがデフォルトで無効になっている場合、アプリケーションがクリア HTTP 要求を実行しようとすると、IOException がスローされ、次のメッセージが表示されます。</p>

<pre>
<code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>

<p>詳細については、Googleのウェブサイトをご覧ください：<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28#framework-security-changes">フレームワークのセキュリティの変更</a>そして<a href="https://developer.android.com/training/articles/security-config">ネットワークセキュリティ構成</a>。</p>

<p>アプリが Android Pie（API レベル 28）以上を対象とする場合、アプリが期待どおりに動作するように、この動作の変更を処理する必要があります。このオプションには次の3つがあります。</p>

<ul>
	<li><a href="#HTTPS_only">アプリが HTTPS リクエストのみを行うようにする</a></li>
	<li><a href="#HTTP_for_all_domains">すべてのドメインに対して HTTP トラフィックをクリアする</a></li>
	<li><a href="#HTTP_for_specific_domains">特定のドメインに対して HTTP トラフィックをクリアする</a></li>
</ul>
<!-- <p>With the release of Android Pie (API level 28), clear text traffic is disabled by default. If your application attempts to do a clear HTTP request, an <code translate="No">IOException</code> will be thrown with the message:</p>
  <pre><code class="language-java" translate="No">Exception: IOException java.io.IOException: Cleartext HTTP traffic to * not permitted</code></pre>
  <p>
    To learn more about managing TLS with Android Pie, see the following document:
https://docs.google.com/document/d/1PfXOq59MG8s87gcwiZvzWCZ_CuKDpLi3VO-VRF_LkjY/edit?usp=sharing
  </p> -->

<h3 id="HTTPS_only">HTTPSのみ</h3>

<p>1 つのオプションは、すべてのネットワークリクエストが HTTPS を使用していることを確認することです。これを行うには、次の手順を実行します。</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>安全な通信のために CDN を有効にします。</p>

	<ul>
		<li>Video Cloud のお客様は（自社の CDN または指定の CDN のいずれを使用している場合でも）、Brightcoveのアカウントマネージャに連絡して、アカウントが HTTPS 経由で配信されるように設定されていることを確認する必要があります。</li>
		<li>
			<p>
				リモートアセットを使用している場合は、CDN を適切に設定する必要があります。
			</p>
		<aside class="bcls-aside bcls-aside--information">BYO CDNを使用している場合は、正しいパスを渡す必要があります<code translate="No">X-Forwarded-Proto: https</code>ヘッダー。AkamaiまたはCloudfrontの場合、<code translate="No">X-Forwarded-Proto-Akamai</code>また<code translate="No">CloudFront-Forwarded-Proto</code>それぞれ。</aside></li>
	</ul>
	</li>
	<li>
	<p>セキュリティで保護された通信を使用してメディアコンテンツを配信します。これには、動画、広告、キャプション、ポスター画像、サムネイル、その他のサードパーティの API 接続が含まれます。</p>

	<ul>
		<li>
		<p>ビデオクラウドのお客様:Playback API を使用して、各アセットの安全なプロトコルを取得します。Android 版 Brightcove SDK では、利用可能な場合、デフォルトで HTTPS が選択されます。</p>

		<aside class="bcls-aside bcls-aside--information">ビデオにWebVTTキャプション/字幕のHTTPソースとHTTPSソースの両方がある場合、Android用ネイティブSDKはHTTPSバージョンを返さない場合があります。Brightcoveはこの状況を認識しており、将来のリリースで修正される予定です。</aside>
		</li>
		<li>Brightcoveプレーヤーのお客様:メディアコンテンツが HTTPS 経由で配信されていることを確認します。</li>
	</ul>
	</li>
</ol>

<h3 id="HTTP_for_all_domains">すべてのドメインの HTTP</h3>

<p>アプリでは、すべてのドメインでクリアな HTTP トラフィックを使用できます。ここでは、これを行う方法の 2 つの例を挙げます。</p>

<ul>
	<li><a href="#Update_the_application_tag">アプリケーショントグを更新する</a></li>
	<li><a href="#Add_a_network_security_configuration_file">ネットワークセキュリティ設定ファイルを追加する</a></li>
</ul>

<h4 id="Update_the_application_tag">アプリケーショントグを更新する</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p>これを有効にするには、<strong> AndroidManifest </strong>ファイルを開き、<code translate="No">application</code>タグに次の行を追加します。例は次のとおりです。</p>

	<pre>
<code class="language-java" translate="No">&lt;application
   android:name="mypackage.MyApplication"
   <span class="bcls-highlight">android:usesCleartextTraffic="true"&gt;</span>
…
&lt;/application&gt;</code></pre>
	</li>
</ol>

<h4 id="Add_a_network_security_configuration_file">ネットワークセキュリティ設定ファイルを追加する</h4>

<ol class="bcls-tasklist__restart">
	<li>
	<p><strong>network-security-config.xml </strong>などの xml ファイルを作成し、<strong> res/xml </strong>ディレクトリに追加します。クリアトラフィックを許可する方法については、次の例を参照してください。</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
   &lt;base-config cleartextTrafficPermitted="true"/&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>以下に示すように、<strong>あなたのAndroidマニフェストにファイル名を設定します</strong>。</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>詳細については、Android <a href="https://developer.android.com/training/articles/security-config">のネットワークセキュリティ設定ドキュメントを参照してください</a>。</p>
	</li>
</ol>

<h3 id="HTTP_for_specific_domains">特定のドメインの HTTP</h3>

<p>クリア HTTP 要求の使用を許可する特定のドメインを指定できます。これを行うには、次の手順を実行します。</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p><strong>network-security-config.xml </strong>などの xml ファイルを作成し、<strong> res/xml </strong>ディレクトリに追加します。ドメインの設定方法については、次の例を参照してください。</p>

	<pre>
<code class="language-java" translate="No">&lt;network-security-config&gt;
 &lt;domain-config cleartextTrafficPermitted="true"&gt;
     &lt;domain includeSubdomains="true"&gt;c.brightcove.com&lt;/domain&gt;
     &lt;domain includeSubdomains="true"&gt;solutions.brightcove.com&lt;/domain&gt;
 &lt;/domain-config&gt;
&lt;/network-security-config&gt;</code></pre>
	</li>
	<li>
	<p>以下に示すように、<strong>あなたのAndroidマニフェストにファイル名を設定します</strong>。</p>

	<pre>
<code class="language-java" translate="No">&lt;application
 android:name="mypackage.MyApplication"
 <span class="bcls-highlight">android:networkSecurityConfig="@xml/network_security_config"&gt;</span>
…
&lt;/application&gt;</code></pre>

	<p>詳細については、Android <a href="https://developer.android.com/training/articles/security-config">のネットワークセキュリティ設定ドキュメントを参照してください</a>。</p>

	<aside class="bcls-aside bcls-aside--information">NS <code translate="No">networkSecurityConfig</code>パラメータは<code translate="No">usesCleartextTraffic</code>パラメータ。これは、両方が有効になっている場合、で宣言されているドメインのみが<code translate="No">networkSecurityConfig</code> fileパラメータはクリアHTTPリクエストの使用を許可されます。</aside>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Apache_HTTP_client_deprecation">Apache HTTP クライアントの非推奨</h2>

<p>Android パイでは、Apache HTTP クライアントのサポートが削除されました。これは、Android Pie 以上を対象とするアプリに影響します。非標準を使用している場合、古いバージョンの Android をターゲットとするアプリにも影響する可能性があります<code translate="No">ClassLoader</code>。実行時に、が Android Pie に Apache HTTP <code translate="No">ClassLoader</code>クライアントクラスをロードしようとすると、がスローされます<code translate="No">NoClassDefFoundError</code>。詳細については、Google の以下のページをご覧ください。<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-all#apache-nonp">Apache HTTP クライアントの非推奨ドキュメント</a>。</p>

<p>アプリで Brightcove FreeWheel プラグインを使用している場合、この問題が発生し、次に示すように例外が発生します。</p>

<pre>
<code class="language-java" translate="No">java.lang.NoClassDefFoundError: tv.freewheel.utils.URLLoader
Caused by: java.lang.NoClassDefFoundError: Failed resolution of: Lorg/apache/http/impl/client/BasicCookieStore;</code></pre>

<p>この問題を解決するには、アプリのマニフェストファイルに次の行を含めます。</p>

<pre>
<code class="language-java" translate="No">&lt;uses-library android:name="org.apache.http.legacy" android:required="false"/&gt;</code></pre>
</section>

<section class="bcls-section">
<h2 id="Deprecated_constants">廃止された定数</h2>

<p><a href="https://developer.android.com/reference/android/net/ConnectivityManager">ConnectivityManager </a>クラスでは廃止された定数がいくつかあります。これらの定数の一部は、現在、Brightcove SDK、特にオフライン再生およびオフライン分析機能によって使用されています。ここにリストがあります：</p>

<ul>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_BLUETOOTH</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_ETHERNET</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_MOBILE</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_VPN</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIFI</code></li>
	<li><code translate="No">android.net.ConnectivityManager.TYPE_WIMAX</code></li>
</ul>

<p>これは、上記の機能の機能には影響しませんが、これらの定数は将来のAndroid OSバージョンで削除される可能性があることに注意してください。これは、Brightcoveのネイティブ SDK にも適用されます。</p>
</section>
<!-- <section class="bcls-section">
<h2 id="Testing_limitations">Testing limitations</h2>

<p>Due to resource constraints, we have been unable to test the Brightcove SDK targeting Android Pie on a device that has a "cut-out" in its display. We are working on acquiring such a device to test with as soon as possible.</p>
</section> --></article>