---
title: 'Android用ネイティブSDKを使用してプログラムでキャプションを選択する' 
description: このトピックでは、Brightcove Native SDK forAndroidを使用するときにプログラムでキャプションを選択する方法を学習します。
parent: Captions 
grandparent: Androidの開発
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>


<section class="bcls-section">
  <h2 id="Overview">概要</h2>
  <p>
    Android 用ネイティブ SDK は、次のいずれかのキャプションを受け取ります。
  </p>
  <ul>
    <li>Brightcoveのカタログレスポンス (再生 API):サイドカーWebVTT</li>
    <li>ビデオマニフェスト（HLSまたはダッシュ）：マニフェストの WebVTT </li>
  </ul>
  <p>
    キャプションの詳細については、「<a href="https://sdks.support.brightcove.com/features/using-captions-brightcove-native-sdks.html"> Brightcove ネイティブ SDK でキャプションを使用する</a>」を参照してください。
  </p>
</section>

<section class="bcls-section">
  <h2 id="Event_sequence">イベントシーケンス</h2>
  <p>
    ネイティブ SDK は、キャプションに関連付けられた次のイベントシーケンスに従います。
  </p>
  <ol class="bcls-tasklist">
    <li>
      <p>
        Brightcoveのカタログから動画を取得する（例：<code translate="No">catalog.findVideoByID()</code> )。
      </p>
    </li>
    <li>
      <p>
        サイドカーキャプションは、カタログ応答から解析され、ビデオプロパティに追加されます。
      </p>
    </li>
    <li>
      <p>
        この時点で、次のようにキャプションソースを取得できます。
      </p>
      <pre><code class="language-java" translate="No">video.getProperties().get(Video.Fields.CAPTION_SOURCES);</code></pre>
    </li>
    <li>
      <p>
        ビデオビューを設定します。動画がExoPlayerに追加されます。
      </p>
      <pre><code class="language-java" translate="No">brightcoveVideoView.add(video);</code></pre>
    </li>
    <li>
      <p>
        ネイティブ SDK は、キャプションソースを取得し、次のイベントを発します。
      </p>
      <pre><code class="language-java" translate="No">EventType.CAPTIONS_LANGUAGES</code></pre>
    </li>
    <li>
      <p>
        ビデオが ExoPlayer に追加されると、ネイティブ SDK はマニフェスト内のキャプションを探します。ビデオキャプションソースにまだ存在しないキャプションが追加されます。新しいキャプションソースがある場合、次のイベントが送信されて Brightcove メディアコントローラを更新します。
      </p>
      <pre><code class="language-java" translate="No">EventType.CAPTIONS_LANGUAGES</code></pre>
    </li>
  </ol>
</section>

<section class="bcls-section">
  <h2 id="Select_captions">キャプションを選択</h2>
  <p>
    プログラムでキャプションを選択するには、次の手順に従います。
  </p>
  <ol class="bcls-tasklist__restart">
    <li>
      <p>
        言語コードを使用して特定のキャプションソースを検索するメソッドを作成します。例は次のとおりです。
      </p>
      <pre><code class="language-java" translate="No">private Pair&lt;Uri, BrightcoveCaptionFormat&gt; getCaptionsForLanguageCode(Video video, String languageCode) {
 Object payload = video == null ? null : video.getProperties().get(Video.Fields.CAPTION_SOURCES);

if (payload instanceof List) {
 @SuppressWarnings(&quot;unchecked&quot;)
 List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt; pairs =
    (List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt;) payload;

 for (Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair : pairs) {
   if (pair.second.language().equals(languageCode)) {
     return pair;
   }
 }
}
return null;
}</code></pre>
    </li>
    <li>
      <p>
        キャプションソースがにあることに注意してください<code translate="No">Pair&lt;Uri, BrightcoveCaptionFormat&gt;</code>。<code translate="No">Uri</code>ペアのは、クローズドキャプションの種類を示します。
      </p>
      <ul>
        <li>
          <strong>サイドカー</strong> :完全なURLが存在する
        </li>
        <li>
          <strong>マニフェスト</strong> :BrightCoveCaptionFormat.BrightCove_scheme
        </li>
      </ul>
    </li>
    <li>
      <p>
        <code translate="No">EventType.SELECT_CLOSED_CAPTION_TRACK</code>イベントを発生させることにより、特定の言語コードでビデオからクローズドキャプションを選択するメソッドを作成します。
      </p>
      <pre><code class="language-java" translate="No">private void selectCaption(Video video, String language) {
 Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair = getCaptionsForLanguageCode(video, language);

if (pair != null &amp;&amp; !pair.first.equals(Uri.EMPTY)) {
 // BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME indicates that is not a URL we need to load with the LoadCaptionsService, but instead we'll be enabled through a different component.
 if (!pair.first.toString().startsWith(BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME)) {
   brightcoveVideoView.getClosedCaptioningController().getLoadCaptionsService().loadCaptions(pair.first, pair.second.type());
 }
 Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
 properties.put(Event.CAPTION_FORMAT, pair.second);
 properties.put(Event.CAPTION_URI, pair.first);
 brightcoveVideoView.getEventEmitter().emit(EventType.SELECT_CLOSED_CAPTION_TRACK, properties);
}
}</code></pre>
    </li>
    <li>
      <p>
        <code translate="No">EventType.CAPTIONS_LANGUAGES</code>イベントを聞き、言語コードで目的の言語を選択します。
      </p>
      <pre><code class="language-java" translate="No">brightcoveVideoView.getEventEmitter().once(EventType.CAPTIONS_LANGUAGES, new EventListener() {
@Override
public void processEvent(Event event) {
 brightcoveVideoView.setClosedCaptioningEnabled(true);

  // You could find the desired languaged in the LANGUAGES list.
  // List&lt;String&gt; languages = event.getProperty(Event.LANGUAGES, List.class);
 selectCaption(brightcoveVideoView.getCurrentVideo(), &quot;ja&quot;);
}
});</code></pre>
    </li>

  </ol>
</section>

</article>